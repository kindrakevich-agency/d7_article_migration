id: d7_article_nodes
label: 'D7 Article Nodes'
migration_group: d7_migration
source:
  # Use our custom source plugin
  plugin: d7_article_node_custom
  # Define the D7 node type
  node_type: 'article'
process:
  # Set D11 node type
  type:
    plugin: default_value
    default_value: 'article'
  title: title
  uid: node_uid
  status: status
  created: created
  changed: changed
  promote: promote
  sticky: sticky
  
  # Body field, with image migration (Req #5)
  'body/value':
    plugin: embedded_data
    source: body/0/value
    process:
      # This plugin finds <img> tags
      plugin: 'image_munger'
      method: 'id'
      source_field: 'fid'
      destination_file_field: 'uri'
      # Looks up the file in our file migration
      migration: 'd7_all_image_files'
  'body/format':
    plugin: default_value
    default_value: 'full_html'

  # Tags (Req #4)
  'field_tags/target_id':
    plugin: migration_lookup
    migration: d7_taxonomy_tags
    source: field_tags/tid

  # Image field (Req #4, multiple)
  field_image:
    plugin: sub_process
    source: field_image
    process:
      target_id:
        plugin: migration_lookup
        migration: d7_all_image_files
        source: fid
      alt: alt
      title: title
      width: width
      height: height

destination:
  plugin: 'entity:node'
migration_dependencies:
  required:
    - d7_taxonomy_tags
    - d7_all_image_files
